<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    <style>
        #korisnikDiv {
            display: none;
        }

        #dispecerDiv {
            display: none;
        }
    </style>

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Taxi Application</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/StyleHtml/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/StyleHtml/css/font-awesome.min.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            let primljeno = localStorage.getItem("logovan");
            let usernameKor;
            let polShow;
            $.ajax({
                type: 'POST',
                url: '/api/Start',
                data: JSON.stringify(primljeno),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    dataTmp = data;
                    usernameKor = `${dataTmp.KorisnickoIme}`;
                    if (data != null) {
                        alert('Uspesno slanje.');
                        if (data.Uloga == 2) {   // dispecer login
                            $("#dispecerDiv").show();
                            $("#IzmeniDispecera").hide();
                            $("#korisnikDiv").hide();
                            $("#usernameDispecera").show();
                            $("#usernameDispecera").html(usernameKor);
                            if (data.Pol == 0) // musko
                            {
                                polShow = "Musko";
                            }
                            else {
                                polShow = "Zensko";
                            }
                        } else if (data.Uloga == 0) { // musterija login
                            $("#korisnikDiv").show();
                            $("#IzmeniKorisnika").hide();
                            $("#dispecerDiv").hide();
                            $("#usernameKorisnika").show();
                            $("#usernameKorisnika").html(usernameKor);
                            if (data.Pol == 0) // musko
                            {
                                polShow = "Musko";
                            }
                            else {
                                polShow = "Zensko";
                            }
                        } else {
                        }
                    } else {
                        alert('Neuspesno slanje.');
                    }
                },
            })

            $("#showInfo").click(function () {
                $("#PrikazKorisnikInfo").show();

                let tableofData = "<table class=\"table table-bordered\">";
                tableofData += `<tr><td>ID</td><td>${dataTmp.Id}</td></tr>`;
                tableofData += `<tr><td>Korisnicko ime</td><td>${dataTmp.KorisnickoIme}</td></tr>`;
                tableofData += `<tr><td>Lozinka</td><td>${dataTmp.Lozinka}</td></tr>`;
                tableofData += `<tr><td>Ime</td><td>${dataTmp.Ime}</td></tr>`;
                tableofData += `<tr><td>Prezime</td><td>${dataTmp.Prezime}</td></tr>`;
                tableofData += `<tr><td>JMBG</td><td>${dataTmp.JMBG}</td></tr>`;
                tableofData += `<tr><td>Pol</td><td>${polShow}</td></tr>`;
                tableofData += `<tr><td>Kontakt telefon</td><td>${dataTmp.KontaktTelefon}</td></tr>`;
                tableofData += `<tr><td>Email</td><td>${dataTmp.Email}</td></tr>`;
                tableofData += "</table>";
                $("#PrikazKorisnikInfoShow").html(tableofData);
            });

            $("#izmeniKorisnik").click(function () {
                $("#PrikazKorisnikInfo").hide();

                let tableofData = "<table class=\"table table-bordered\">";
                tableofData += "<tr><td>Korisnicko ime</td><td><input class=\"form-control\" id=\"korImeReg\" type=\"text\" name=\"KorisnickoIme\" value=\"" + dataTmp.KorisnickoIme + "\" disabled /></td></tr>";
                tableofData += "<tr><td>Lozinka</td><td><input class=\"form-control\" id=\"korPassReg\" type=\"password\" name=\"Lozinka\" value=\"" + dataTmp.Lozinka + "\"/></td></tr>";
                tableofData += "<tr><td>Ime</td><td><input class=\"form-control\" id=\"ime\" type=\"text\" name=\"Ime\" value=\"" + dataTmp.Ime + "\"/></td></tr>";
                tableofData += "<tr><td>Prezime</td><td><input class=\"form-control\" id=\"prezime\" type=\"text\" name=\"Prezime\" value=\"" + dataTmp.Prezime + "\"/></td></tr>";
                tableofData += "<tr><td>JMBG</td><td><input class=\"form-control\" id=\"jmbg\" type=\"text\" name=\"JMBG\" value=\"" + dataTmp.JMBG + "\"/></td></tr>";
                tableofData += "<tr><td>Email</td><td><input class=\"form-control\" id=\"email\" type=\"email\" name=\"Email\" value=\"" + dataTmp.Email + "\"/></td></tr>";
                tableofData += "<tr><td>Kontakt telefon</td><td><input class=\"form-control\" id=\"brTelefona\" type=\"text\" name=\"KontaktTelefon\" value=\"" + dataTmp.KontaktTelefon + "\"/></td></tr>";
                tableofData += "</table>";
                $("#IzmenaShow").html(tableofData);
            });

            $("#showInfoDisp").click(function () {
                $("#PrikazKorisnikInfoDisp").show();

                let tableofData = "<table class=\"table table-bordered\">";
                tableofData += `<tr><td>ID</td><td>${dataTmp.Id}</td></tr>`;
                tableofData += `<tr><td>Korisnicko ime</td><td>${dataTmp.KorisnickoIme}</td></tr>`;
                tableofData += `<tr><td>Lozinka</td><td>${dataTmp.Lozinka}</td></tr>`;
                tableofData += `<tr><td>Ime</td><td>${dataTmp.Ime}</td></tr>`;
                tableofData += `<tr><td>Prezime</td><td>${dataTmp.Prezime}</td></tr>`;
                tableofData += `<tr><td>JMBG</td><td>${dataTmp.JMBG}</td></tr>`;
                tableofData += `<tr><td>Pol</td><td>${polShow}</td></tr>`;
                tableofData += `<tr><td>Kontakt telefon</td><td>${dataTmp.KontaktTelefon}</td></tr>`;
                tableofData += `<tr><td>Email</td><td>${dataTmp.Email}</td></tr>`;
                tableofData += "</table>";
                $("#PrikazKorisnikInfoShowDisp").html(tableofData);
            });

            $("#potvrdiIzmenu").click(function () {
                let korisnik = {
                    Id: dataTmp.Id,
                    KorisnickoIme: `${$('#korImeReg').val()}`,
                    Lozinka: `${$('#korPassReg').val()}`,
                    Ime: `${$('#ime').val()}`,
                    Prezime: `${$('#prezime').val()}`,
                    Pol: dataTmp.Pol,
                    JMBG: ` ${$('#jmbg').val()}`,
                    Email: `${$('#email').val()}`,
                    KontaktTelefon: `${$('#brTelefona').val()}`,
                    Uloga: dataTmp.Uloga
                };

                $.ajax({
                    type: 'PUT',
                    url: '/api/Korisnik/' + dataTmp.Id,
                    data: JSON.stringify(korisnik),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert('Uspesno izmenjen korisnik');
                            localStorage.setItem("logovan", korisnik.KorisnickoIme);
                            $(location).attr('href', 'welcome.html');
                        } else {
                            alert('Ne postoji korisnik kojeg zelite da menjate');
                        }
                    },
                })
            });

            $("#izmeniKorisnikDisp").click(function () {
                $("#PrikazKorisnikInfoDisp").hide();

                let tableofData = "<table class=\"table table-bordered\">";
                tableofData += "<tr><td>Korisnicko ime</td><td><input class=\"form-control\" id=\"korImeReg\" type=\"text\" name=\"KorisnickoIme\" value=\"" + dataTmp.KorisnickoIme + "\" disabled /></td></tr>";
                tableofData += "<tr><td>Lozinka</td><td><input class=\"form-control\" id=\"korPassReg\" type=\"password\" name=\"Lozinka\" value=\"" + dataTmp.Lozinka + "\"/></td></tr>";
                tableofData += "<tr><td>Ime</td><td><input class=\"form-control\" id=\"ime\" type=\"text\" name=\"Ime\" value=\"" + dataTmp.Ime + "\"/></td></tr>";
                tableofData += "<tr><td>Prezime</td><td><input class=\"form-control\" id=\"prezime\" type=\"text\" name=\"Prezime\" value=\"" + dataTmp.Prezime + "\"/></td></tr>";
                tableofData += "<tr><td>JMBG</td><td><input class=\"form-control\" id=\"jmbg\" type=\"text\" name=\"JMBG\" value=\"" + dataTmp.JMBG + "\"/></td></tr>";
                tableofData += "<tr><td>Email</td><td><input class=\"form-control\" id=\"email\" type=\"email\" name=\"Email\" value=\"" + dataTmp.Email + "\"/></td></tr>";
                tableofData += "<tr><td>Kontakt telefon</td><td><input class=\"form-control\" id=\"brTelefona\" type=\"text\" name=\"KontaktTelefon\" value=\"" + dataTmp.KontaktTelefon + "\"/></td></tr>";
                tableofData += "</table>";
                $("#IzmenaShowDisp").html(tableofData);
            });

            $("#potvrdiIzmenuDisp").click(function () {
                let korisnik = {
                    Id: dataTmp.Id,
                    KorisnickoIme: `${$('#korImeReg').val()}`,
                    Lozinka: `${$('#korPassReg').val()}`,
                    Ime: `${$('#ime').val()}`,
                    Prezime: `${$('#prezime').val()}`,
                    Pol: dataTmp.Pol,
                    JMBG: ` ${$('#jmbg').val()}`,
                    Email: `${$('#email').val()}`,
                    KontaktTelefon: `${$('#brTelefona').val()}`,
                    Uloga: dataTmp.Uloga
                };

                $.ajax({
                    type: 'PUT',
                    url: '/api/Korisnik/' + dataTmp.Id,
                    data: JSON.stringify(korisnik),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert('Uspesno izmenjen korisnik');
                            localStorage.setItem("logovan", korisnik.KorisnickoIme);
                            $(location).attr('href', 'welcome.html');
                        } else {
                            alert('Ne postoji korisnik kojeg zelite da menjate');
                        }
                    },
                })
            });

            $("#dodajVozaca").click(function () {
                $("#PrikazKorisnikInfoDisp").hide();
            });

            $("#addVozac").click(function () {
                let adresa = {
                    Id: `${$('#idadrese').val()}`,
                    UlicaIBroj: `${$('#ulicaibroj').val()}`,
                    NaseljenoMesto: `${$('#naseljenomesto').val()}`,
                    PozivniBroj: `${$('#pozivnibroj').val()}`
                };

                let lokacija = {
                    Id: `${$('#idlokacije').val()}`,
                    X: `${$('#x').val()}`,
                    Y: `${$('#y').val()}`,
                    Adresa: adresa
                };

                let automobil = {
                    Godiste: `${$('#godiste').val()}`,
                    Registracija: `${$('#registracija').val()}`,
                    BrojVozila: `${$('#brojvozila').val()}`,
                    TipAuta: `${$('#tipauta').val()}`
                };

                let vozac = {
                    KorisnickoIme: `${$('#korImeRegVoz').val()}`,
                    Lozinka: `${$('#korPassRegVoz').val()}`,
                    Ime: `${$('#imeVoz').val()}`,
                    Prezime: `${$('#prezimeVoz').val()}`,
                    Pol: `${$('#polVoz').val()}`,
                    JMBG: `${$('#jmbgVoz').val()}`,
                    KontaktTelefon: `${$('#brTelefonaVoz').val()}`,
                    Email: `${$('#emailVoz').val()}`,
                    Lokacija: lokacija,
                    Automobil: automobil
                };

                $.ajax({
                    type: 'POST',
                    url: '/api/Vozac',
                    data: JSON.stringify(vozac),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert('Uspesno registovan vozac');
                            $(location).attr('href', 'welcome.html');
                        } else {
                            alert('Vozac je vec registrovan');
                        }
                    },
                })
            });
        });
    </script>
</head>
<body>
    <!-- korisnicki div -->
    <div class="container" id="korisnikDiv">
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <div class="well">
                    <h3 align="center">
                        <span>
                            Hello, <span id="usernameKorisnika"></span> <br /> <br />
                        </span>
                        <span>
                            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#editModal" id="izmeniKorisnik">Edit info</button>
                            <button type="button" class="btn btn-warning" id="showInfo">Show info</button>
                        </span>
                    </h3>
                </div>
            </div>
        </div>

        <!-- show info div-->
        <div class="container" id="PrikazKorisnikInfo">
            <div class="row">
                <div class="well well-float" id="PrikazKorisnikInfoShow">
                </div>
            </div>
        </div>

        <!-- edit info -->

        <!-- edit modal -->
        <div class="modal fade" id="editModal">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h3 class="modal-title">Edit user info</h3>
                    </div>
                    <div class="modal-body" id="IzmenaShow">
                        
                    </div>

                    <div class="modal-footer">
                        <a href="" class="btn btn-default" data-dismiss="modal">Close</a>
                        <button type="submit" class="btn btn-success" id="potvrdiIzmenu">Apply changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- div za dispecere -->
    <div class="container" id="dispecerDiv">
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <div class="well">
                    <h3 align="center">
                        <span>
                            DISPECER: <span id="usernameDispecera"></span> <br /> <br />
                        </span>
                        <span>
                            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#editModalDisp" id="izmeniKorisnikDisp">Edit info</button>
                            <button type="button" class="btn btn-warning" id="showInfoDisp">Show info</button>
                            <button type="button" class="btn btn-info" data-toggle="modal" data-target="#addDriver" id="dodajVozaca">Add new driver</button>
                        </span>
                    </h3>
                </div>
            </div>
        </div>

        <!-- show info div-->
        <div class="container" id="PrikazKorisnikInfoDisp">
            <div class="row">
                <div class="well well-float" id="PrikazKorisnikInfoShowDisp">
                </div>
            </div>
        </div>

        <!-- edit info -->
        <!-- edit modal -->
        <div class="modal fade" id="editModalDisp">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h3 class="modal-title">Edit dispecer info</h3>
                    </div>
                    <div class="modal-body" id="IzmenaShowDisp">

                    </div>

                    <div class="modal-footer">
                        <a href="" class="btn btn-default" data-dismiss="modal">Close</a>
                        <button type="submit" class="btn btn-success" id="potvrdiIzmenuDisp">Apply changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- vozac register modal -->
        <div class="modal fade" id="addDriver">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h3 class="modal-title">Add new driver</h3>
                    </div>
                    <div class="modal-body" id="DodavanjeVozaca">
                        <div class="form-group">
                            <label class="control-label">Username</label>
                            <input type="text" class="form-control" id="korImeRegVoz" name="KorisnickoIme">
                        </div>

                        <div class="form-group">
                            <label class="control-label">Password</label>
                            <input type="password" class="form-control" id="korPassRegVoz" name="Lozinka">
                        </div>

                        <div class="form-group">
                            <label class="control-label">Name</label>
                            <input type="text" class="form-control" id="imeVoz" name="Ime">
                        </div>

                        <div class="form-group">
                            <label class="control-label">Surname</label>
                            <input type="text" class="form-control" id="prezimeVoz" name="Prezime">
                        </div>

                        <div class="form-group">
                            <label class="control-label">Gender</label>
                            <select class="form-control" id="polVoz" name="Pol">
                                <option value="M">M</option>
                                <option value="Z">Z</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="control-label">JMBG</label>
                            <input type="text" class="form-control" id="jmbgVoz" name="JMBG">
                        </div>

                        <div class="form-group">
                            <label class="control-label">Phone</label>
                            <input type="text" class="form-control" id="brTelefonaVoz" name="KontaktTelefon">
                        </div>

                        <div class="form-group">
                            <label class="control-label">Email</label>
                            <input type="email" class="form-control" id="emailVoz" name="Email">
                        </div>

                        <div class="form-group">
                            <label class="control-label">Year of car</label>
                            <input type="text" class="form-control" id="godiste" name="Godiste">
                        </div>

                        <div class="form-group">
                            <label class="control-label">Registration num</label>
                            <input type="text" class="form-control" id="registracija" name="Registracija">
                        </div>

                        <div class="form-group">
                            <label class="control-label">Car number</label>
                            <input type="text" class="form-control" id="brojvozila" name="BrojVozila">
                        </div>

                        <div class="form-group">
                            <label class="control-label">Type of car</label>
                            <select class="form-control" id="tipauta" name="TipAuta">
                                <option value="Putnicki">Putnicki</option>
                                <option value="Kombi">Kombi</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="control-label">ID location</label>
                            <input type="text" class="form-control" id="idlokacije" name="Id">
                        </div>

                        <div class="form-group">
                            <label class="control-label">X coordinates</label>
                            <input type="text" class="form-control" id="x" name="X">
                        </div>

                        <div class="form-group">
                            <label class="control-label">Y coordinates</label>
                            <input type="text" class="form-control" id="y" name="Y">
                        </div>

                        <div class="form-group">
                            <label class="control-label">Address ID</label>
                            <input type="text" class="form-control" id="idadrese" name="Id">
                        </div>

                        <div class="form-group">
                            <label class="control-label">Street and number</label>
                            <input type="text" class="form-control" id="ulicaibroj" name="UlicaIBroj">
                        </div>

                        <div class="form-group">
                            <label class="control-label">City</label>
                            <input type="text" class="form-control" id="naseljenomesto" name="NaseljenoMesto">
                        </div>

                        <div class="form-group">
                            <label class="control-label">Zip code</label>
                            <input type="text" class="form-control" id="pozivnibroj" name="PozivniBroj">
                        </div>
                    </div>

                    <div class="modal-footer">
                        <a href="" class="btn btn-default" data-dismiss="modal">Close</a>
                        <button type="submit" class="btn btn-success" id="addVozac">Add driver</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Latest compiled and minified JavaScript -->
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
</body>
</html>
